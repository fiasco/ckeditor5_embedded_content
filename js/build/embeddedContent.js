!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.CKEditor5=n():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.embeddedContent=n())}(self,(()=>(()=>{var __webpack_modules__={"./js/ckeditor5_plugins/embeddedContent/src/embeddedcontent.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "default": () => (/* binding */ EmbeddedContent)\n/* harmony export */ });\n/* harmony import */ var ckeditor5_src_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ckeditor5/src/core */ "ckeditor5/src/core.js");\n/* harmony import */ var _embeddedcontentediting__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./embeddedcontentediting */ "./js/ckeditor5_plugins/embeddedContent/src/embeddedcontentediting.js");\n/* harmony import */ var _embeddedcontentui__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./embeddedcontentui */ "./js/ckeditor5_plugins/embeddedContent/src/embeddedcontentui.js");\n\n\n\n\n/**\n * Main entry point to the embedded content.\n */\nclass EmbeddedContent extends ckeditor5_src_core__WEBPACK_IMPORTED_MODULE_0__.Plugin {\n\n  /**\n   * @inheritdoc\n   */\n  static get requires() {\n    return [\n      _embeddedcontentediting__WEBPACK_IMPORTED_MODULE_1__["default"],\n      _embeddedcontentui__WEBPACK_IMPORTED_MODULE_2__["default"]\n    ];\n  }\n\n  /**\n   * @inheritdoc\n   */\n  static get pluginName() {\n    return \'embeddedContent\';\n  }\n}\n\n\n//# sourceURL=webpack://CKEditor5.embeddedContent/./js/ckeditor5_plugins/embeddedContent/src/embeddedcontent.js?')},"./js/ckeditor5_plugins/embeddedContent/src/embeddedcontentcommand.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ EmbeddedContentCommand)\n/* harmony export */ });\n/* harmony import */ var ckeditor5_src_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ckeditor5/src/core */ \"ckeditor5/src/core.js\");\n\n\n/**\n * Creates embedded content\n */\nfunction createEmbeddedContent(writer, attributes) {\n  return writer.createElement('embeddedContent', attributes);\n}\n\n/**\n * Command for inserting <embedded-content> tag into ckeditor.\n */\nclass EmbeddedContentCommand extends ckeditor5_src_core__WEBPACK_IMPORTED_MODULE_0__.Command {\n  execute(attributes) {\n    const embeddedContentEditing = this.editor.plugins.get('embeddedContentEditing');\n\n    // Create object that contains supported data-attributes in view data by\n    // flipping `DrupalMediaEditing.attrs` object (i.e. keys from object become\n    // values and values from object become keys).\n    const dataAttributeMapping = Object.entries(embeddedContentEditing.attrs).reduce(\n      (result, [key, value]) => {\n        result[value] = key;\n        return result;\n      },\n      {},\n    );\n\n    // \\Drupal\\media\\Form\\EditorMediaDialog returns data in keyed by\n    // data-attributes used in view data. This converts data-attribute keys to\n    // keys used in model.\n    const modelAttributes = Object.keys(attributes).reduce(\n      (result, attribute) => {\n        if (dataAttributeMapping[attribute]) {\n          result[dataAttributeMapping[attribute]] = attributes[attribute];\n        }\n        return result;\n      },\n      {},\n    );\n\n    this.editor.model.change((writer) => {\n      this.editor.model.insertContent(\n        createEmbeddedContent(writer, modelAttributes),\n      );\n    });\n  }\n\n  refresh() {\n    const model = this.editor.model;\n    const selection = model.document.selection;\n    const allowedIn = model.schema.findAllowedParent(\n      selection.getFirstPosition(),\n      'embeddedContent',\n    );\n    this.isEnabled = allowedIn !== null;\n  }\n}\n\n\n//# sourceURL=webpack://CKEditor5.embeddedContent/./js/ckeditor5_plugins/embeddedContent/src/embeddedcontentcommand.js?")},"./js/ckeditor5_plugins/embeddedContent/src/embeddedcontentediting.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ EmbeddedContentEditing)\n/* harmony export */ });\n/* harmony import */ var ckeditor5_src_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ckeditor5/src/core */ \"ckeditor5/src/core.js\");\n/* harmony import */ var ckeditor5_src_widget__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ckeditor5/src/widget */ \"ckeditor5/src/widget.js\");\n/* harmony import */ var _embeddedcontentcommand__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./embeddedcontentcommand */ \"./js/ckeditor5_plugins/embeddedContent/src/embeddedcontentcommand.js\");\n\n\n\n\n/**\n * Embedded content editing functionality.\n */\nclass EmbeddedContentEditing extends ckeditor5_src_core__WEBPACK_IMPORTED_MODULE_0__.Plugin {\n\n  /**\n   * @inheritdoc\n   */\n  static get requires() {\n    return [ckeditor5_src_widget__WEBPACK_IMPORTED_MODULE_1__.Widget];\n  }\n\n  /**\n   * @inheritdoc\n   */\n  init() {\n    this.attrs = {\n      embeddedContentConfig: 'data-config',\n      embeddedContentUuid: 'data-uuid',\n    };\n    const options = this.editor.config.get('embeddedContent');\n    if (!options) {\n      return;\n    }\n    const {previewURL, themeError} = options;\n    this.previewUrl = previewURL;\n    this.themeError =\n      themeError ||\n      `\n      <p>${Drupal.t(\n        'An error occurred while trying to preview the embedded content. Please save your work and reload this page.',\n      )}<p>\n    `;\n\n    this._defineSchema();\n    this._defineConverters();\n\n    this.editor.commands.add(\n      'embeddedContent',\n      new _embeddedcontentcommand__WEBPACK_IMPORTED_MODULE_2__[\"default\"](this.editor),\n    );\n  }\n\n  /**\n   * Fetches the preview.\n   */\n  async _fetchPreview(modelElement) {\n    const query = {\n      config: modelElement.getAttribute('embeddedContentConfig'),\n    };\n    const response = await fetch(\n      `${this.previewUrl}?${new URLSearchParams(query)}`\n    );\n    if (response.ok) {\n      return await response.text();\n    }\n\n    return this.themeError;\n  }\n\n  /**\n   * Registers embeddedContent as a block element in the DOM converter.\n   */\n  _defineSchema() {\n    const schema = this.editor.model.schema;\n    schema.register('embeddedContent', {\n      allowWhere: '$block',\n      isObject: true,\n      isContent: true,\n      isBlock: true,\n      allowAttributes: Object.keys(this.attrs),\n    });\n    this.editor.editing.view.domConverter.blockElements.push('embedded-content');\n  }\n\n  /**\n   * Defines handling of drupal media element in the content lifecycle.\n   *\n   * @private\n   */\n  _defineConverters() {\n    const conversion = this.editor.conversion;\n\n    conversion\n      .for('upcast')\n      .elementToElement({\n        view: {\n          name: 'embedded-content',\n        },\n        model: 'embeddedContent',\n      });\n\n    conversion\n      .for('dataDowncast')\n      .elementToElement({\n        model: 'embeddedContent',\n        view: {\n          name: 'embedded-content',\n        },\n      });\n    conversion\n      .for('editingDowncast')\n      .elementToElement({\n        model: 'embeddedContent',\n        view: (modelElement, {writer}) => {\n          const container = writer.createContainerElement('figure');\n          return (0,ckeditor5_src_widget__WEBPACK_IMPORTED_MODULE_1__.toWidget)(container, writer, {\n            label: Drupal.t('Media widget'),\n          });\n\n        },\n      })\n      .add((dispatcher) => {\n        const converter = (event, data, conversionApi) => {\n          const viewWriter = conversionApi.writer;\n          const modelElement = data.item;\n          const container = conversionApi.mapper.toViewElement(data.item);\n          const embeddedContent = viewWriter.createRawElement('div', {\n            'data-embedded-content-preview': 'loading',\n            'class': 'embedded-content-preview'\n          });\n          viewWriter.insert(viewWriter.createPositionAt(container, 0), embeddedContent);\n          this._fetchPreview(modelElement).then((preview) => {\n            if (!embeddedContent) {\n              return;\n            }\n            this.editor.editing.view.change((writer) => {\n              const embeddedContentPreview = writer.createRawElement(\n                'div',\n                {'class': 'embedded-content-preview', 'data-embedded-content-preview': 'ready'},\n                (domElement) => {\n                  domElement.innerHTML = preview;\n                },\n              );\n              writer.insert(writer.createPositionBefore(embeddedContent), embeddedContentPreview);\n              writer.remove(embeddedContent);\n            });\n          });\n        };\n\n        dispatcher.on('attribute:embeddedContentUuid:embeddedContent', converter);\n        dispatcher.on(\n          'attribute:drupalElementStyleViewMode:embeddedContent',\n          converter,\n        );\n        dispatcher.on('attribute:embeddedContentEntityType:embeddedContent', converter);\n        dispatcher.on('attribute:embeddedContentAlt:embeddedContent', converter);\n\n        return dispatcher;\n      });\n\n    Object.keys(this.attrs).forEach((modelKey) => {\n      const attributeMapping = {\n        model: {\n          key: modelKey,\n          name: 'embeddedContent',\n        },\n        view: {\n          name: 'embedded-content',\n          key: this.attrs[modelKey],\n        },\n      };\n      conversion.for('dataDowncast').attributeToAttribute(attributeMapping);\n      conversion.for('upcast').attributeToAttribute(attributeMapping);\n    });\n  }\n\n  /**\n   * @inheritdoc\n   */\n  static get pluginName() {\n    return 'embeddedContentEditing';\n  }\n}\n\n\n//# sourceURL=webpack://CKEditor5.embeddedContent/./js/ckeditor5_plugins/embeddedContent/src/embeddedcontentediting.js?")},"./js/ckeditor5_plugins/embeddedContent/src/embeddedcontentui.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ EmbeddedContentUI)\n/* harmony export */ });\n/* harmony import */ var ckeditor5_src_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ckeditor5/src/core */ \"ckeditor5/src/core.js\");\n/* harmony import */ var ckeditor5_src_ui__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ckeditor5/src/ui */ \"ckeditor5/src/ui.js\");\n/* harmony import */ var _theme_icons_embeddedcontent_svg__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../theme/icons/embeddedcontent.svg */ \"./js/ckeditor5_plugins/embeddedContent/theme/icons/embeddedcontent.svg\");\n/* harmony import */ var ckeditor5_src_engine__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ckeditor5/src/engine */ \"ckeditor5/src/engine.js\");\n\n\n\n\n\n/**\n * Ckeditor5 doesn't support double click out of the box.\n * Register it here so we can use it.\n *\n * @Todo Replace double click with a balloon style popup menu to\n *   edit the embedded content item.\n */\nclass DoubleClickObserver extends ckeditor5_src_engine__WEBPACK_IMPORTED_MODULE_3__.DomEventObserver {\n  constructor( view ) {\n    super( view );\n    this.domEventType = 'dblclick';\n  }\n\n  onDomEvent( domEvent ) {\n    this.fire( domEvent.type, domEvent );\n  }\n}\n\n/**\n * Provides the embedded content button and editing.\n */\nclass EmbeddedContentUI extends ckeditor5_src_core__WEBPACK_IMPORTED_MODULE_0__.Plugin {\n\n  init() {\n    const editor = this.editor;\n    const options = this.editor.config.get('embeddedContent');\n    if (!options) {\n      return;\n    }\n\n    const { dialogURL, openDialog, dialogSettings = {} } = options;\n    if (!dialogURL || typeof openDialog !== 'function') {\n      return;\n    }\n    editor.ui.componentFactory.add('embeddedContent', (locale) => {\n      const command = editor.commands.get('embeddedContent');\n      const buttonView = new ckeditor5_src_ui__WEBPACK_IMPORTED_MODULE_1__.ButtonView(locale);\n\n      buttonView.set({\n        label: Drupal.t('Embedded content'),\n        icon: _theme_icons_embeddedcontent_svg__WEBPACK_IMPORTED_MODULE_2__[\"default\"],\n        tooltip: true,\n      });\n\n\n      // Bind the state of the button to the command.\n      buttonView.bind('isOn', 'isEnabled').to(command, 'value', 'isEnabled');\n\n      this.listenTo(buttonView, 'execute', () => {\n        openDialog(\n          dialogURL,\n          ({ attributes }) => {\n            editor.execute('embeddedContent', attributes);\n          },\n          dialogSettings,\n        );\n      });\n\n      return buttonView;\n    });\n\n    const view = editor.editing.view;\n    const viewDocument = view.document;\n\n    view.addObserver( DoubleClickObserver );\n\n    editor.listenTo( viewDocument, 'dblclick', ( evt, data ) => {\n      const modelElement = editor.editing.mapper.toModelElement( data.target);\n      if(modelElement && typeof modelElement.name !== 'undefined' && modelElement.name === 'embeddedContent'){\n        const query = {\n          config: modelElement.getAttribute('embeddedContentConfig'),\n        };\n        openDialog(\n          `${dialogURL}?${new URLSearchParams(query)}`,\n          ({ attributes }) => {\n            editor.execute('embeddedContent', attributes);\n          },\n          dialogSettings,\n        );\n      }\n    } );\n  }\n}\n\n\n//# sourceURL=webpack://CKEditor5.embeddedContent/./js/ckeditor5_plugins/embeddedContent/src/embeddedcontentui.js?")},"./js/ckeditor5_plugins/embeddedContent/src/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _embeddedcontent__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./embeddedcontent */ "./js/ckeditor5_plugins/embeddedContent/src/embeddedcontent.js");\n\n\n/**\n * @private\n */\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({\n  EmbeddedContent: _embeddedcontent__WEBPACK_IMPORTED_MODULE_0__["default"]\n});\n\n\n//# sourceURL=webpack://CKEditor5.embeddedContent/./js/ckeditor5_plugins/embeddedContent/src/index.js?')},"./js/ckeditor5_plugins/embeddedContent/theme/icons/embeddedcontent.svg":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ("<svg xmlns=\\"http://www.w3.org/2000/svg\\" viewBox=\\"0 0 512 512\\">\x3c!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d=\\"M500.3 7.251C507.7 13.33 512 22.41 512 31.1V175.1C512 202.5 483.3 223.1 447.1 223.1C412.7 223.1 383.1 202.5 383.1 175.1C383.1 149.5 412.7 127.1 447.1 127.1V71.03L351.1 90.23V207.1C351.1 234.5 323.3 255.1 287.1 255.1C252.7 255.1 223.1 234.5 223.1 207.1C223.1 181.5 252.7 159.1 287.1 159.1V63.1C287.1 48.74 298.8 35.61 313.7 32.62L473.7 .6198C483.1-1.261 492.9 1.173 500.3 7.251H500.3zM74.66 303.1L86.5 286.2C92.43 277.3 102.4 271.1 113.1 271.1H174.9C185.6 271.1 195.6 277.3 201.5 286.2L213.3 303.1H239.1C266.5 303.1 287.1 325.5 287.1 351.1V463.1C287.1 490.5 266.5 511.1 239.1 511.1H47.1C21.49 511.1-.0019 490.5-.0019 463.1V351.1C-.0019 325.5 21.49 303.1 47.1 303.1H74.66zM143.1 359.1C117.5 359.1 95.1 381.5 95.1 407.1C95.1 434.5 117.5 455.1 143.1 455.1C170.5 455.1 191.1 434.5 191.1 407.1C191.1 381.5 170.5 359.1 143.1 359.1zM440.3 367.1H496C502.7 367.1 508.6 372.1 510.1 378.4C513.3 384.6 511.6 391.7 506.5 396L378.5 508C372.9 512.1 364.6 513.3 358.6 508.9C352.6 504.6 350.3 496.6 353.3 489.7L391.7 399.1H336C329.3 399.1 323.4 395.9 321 389.6C318.7 383.4 320.4 376.3 325.5 371.1L453.5 259.1C459.1 255 467.4 254.7 473.4 259.1C479.4 263.4 481.6 271.4 478.7 278.3L440.3 367.1zM116.7 219.1L19.85 119.2C-8.112 90.26-6.614 42.31 24.85 15.34C51.82-8.137 93.26-3.642 118.2 21.83L128.2 32.32L137.7 21.83C162.7-3.642 203.6-8.137 231.6 15.34C262.6 42.31 264.1 90.26 236.1 119.2L139.7 219.1C133.2 225.6 122.7 225.6 116.7 219.1H116.7z\\"/></svg>\\n");\n\n//# sourceURL=webpack://CKEditor5.embeddedContent/./js/ckeditor5_plugins/embeddedContent/theme/icons/embeddedcontent.svg?')},"ckeditor5/src/core.js":(module,__unused_webpack_exports,__webpack_require__)=>{eval('module.exports = (__webpack_require__(/*! dll-reference CKEditor5.dll */ "dll-reference CKEditor5.dll"))("./src/core.js");\n\n//# sourceURL=webpack://CKEditor5.embeddedContent/delegated_./core.js_from_dll-reference_CKEditor5.dll?')},"ckeditor5/src/engine.js":(module,__unused_webpack_exports,__webpack_require__)=>{eval('module.exports = (__webpack_require__(/*! dll-reference CKEditor5.dll */ "dll-reference CKEditor5.dll"))("./src/engine.js");\n\n//# sourceURL=webpack://CKEditor5.embeddedContent/delegated_./engine.js_from_dll-reference_CKEditor5.dll?')},"ckeditor5/src/ui.js":(module,__unused_webpack_exports,__webpack_require__)=>{eval('module.exports = (__webpack_require__(/*! dll-reference CKEditor5.dll */ "dll-reference CKEditor5.dll"))("./src/ui.js");\n\n//# sourceURL=webpack://CKEditor5.embeddedContent/delegated_./ui.js_from_dll-reference_CKEditor5.dll?')},"ckeditor5/src/widget.js":(module,__unused_webpack_exports,__webpack_require__)=>{eval('module.exports = (__webpack_require__(/*! dll-reference CKEditor5.dll */ "dll-reference CKEditor5.dll"))("./src/widget.js");\n\n//# sourceURL=webpack://CKEditor5.embeddedContent/delegated_./widget.js_from_dll-reference_CKEditor5.dll?')},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},__webpack_module_cache__={};function __webpack_require__(e){var n=__webpack_module_cache__[e];if(void 0!==n)return n.exports;var t=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](t,t.exports,__webpack_require__),t.exports}__webpack_require__.d=(e,n)=>{for(var t in n)__webpack_require__.o(n,t)&&!__webpack_require__.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},__webpack_require__.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__("./js/ckeditor5_plugins/embeddedContent/src/index.js");return __webpack_exports__=__webpack_exports__.default,__webpack_exports__})()));